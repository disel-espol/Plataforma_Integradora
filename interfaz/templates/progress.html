{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block extraheader %}
<link rel="stylesheet" type="text/css" href="{% static 'css/progress.css' %}">
{% endblock extraheader %}

{% block content %}
<div class="col-12">
	<h3>Creación de experimento</h3>
	<div class="spinner-border text-light" role="status" id="experimentLoad">
		<span class="visually-hidden"> </span>
	</div>
	<div class="row align-items-center d-none" id="experimentStart">
		<span class="mr-2">Iniciando máquina</span><div class="spinner-grow spinner-grow-sm text-light" role="status"></div>
	</div>
	<div class="row align-items-center d-none" id="experimentReady">
		<span class="mr-2">Experimento Listo</span><i class="fas fa-check"></i>
	</div>
</div>
<br><br>
<div class="col-12">
	<h3>Pruebas de rendimiento</h3>
	<div class="row">
		<div class="col-4">
			{% if db1 == "MySQL" %}<h4>MySQL</h4>{% endif %}
			{% if db1 == "PostgreSQL" %}<h4>PostgreSQL</h4>{% endif %}
			{% if db1 == "MariaDB" %}<h4>MariaDB</h4>{% endif %}
			<div class="spinner-border text-light" role="status" id="db1Load">
  				<span class="visually-hidden"> </span>
			</div>
			<div class="row align-items-center d-none" id="db1Start">
				<span class="mr-2">Empezando pruebas</span><div class="spinner-grow spinner-grow-sm text-light" role="status"></div>
			</div>
			<div class="row align-items-center d-none" id="db1Ready">
				<span class="mr-2">Pruebas terminadas</span><i class="fas fa-check"></i>
			</div>
		</div>
		{% if db2 != "" %}
		<div class="col-4">
			{% if db2 == "PostgreSQL" %}<h4>PostgreSQL</h4>{% endif %}
			{% if db2 == "MariaDB" %}<h4>MariaDB</h4>{% endif %}
			<div class="spinner-border text-light" role="status" id="db2Load">
  				<span class="visually-hidden"> </span>
			</div>
			<div class="row align-items-center d-none" id="db2Start">
				<span class="mr-2">Empezando pruebas</span><div class="spinner-grow spinner-grow-sm text-light" role="status"></div>
			</div>
			<div class="row align-items-center d-none" id="db2Ready">
				<span class="mr-2">Pruebas terminadas</span><i class="fas fa-check"></i>
			</div>
		</div>
		{% endif %}
		{% if db3 != "" %}
		<div class="col-4">
			<h4>MariaDB</h4>
			<div class="spinner-border text-light" role="status" id="db3Load">
  				<span class="visually-hidden"> </span>
			</div>
			<div class="row align-items-center d-none" id="db3Start">
				<span class="mr-2">Empezando pruebas</span><div class="spinner-border spinner-border-sm text-light" role="status"></div>
			</div>
			<div class="row align-items-center d-none" id="db3Ready">
				<span class="mr-2">Pruebas terminadas</span><i class="fas fa-check"></i>
			</div>
		</div>
		{% endif %}
	</div>
</div>
<br><br>
<div class="col-12 align-items-center" id="div_button">
	<a class="btn btn-secondary" href="{% url 'index' %}">Atrás</a>
	<a class="btn btn-info ml-2 disabled" href="{% url 'results' %}" id="resultsBt"> Ver resultados</a>
</div>
{% endblock content %}
{% block extrafooter %}
<script type="text/javascript">
	function readFile(){
		$.ajax({
			url: '{% url "readFile" %}',
			success: function(data){
				console.log(data.line);
				console.log("Bases:"+data.dbCount);
				if(data.line.match("^SetUp")){
					ch = data.line.split(":");
					console.log(ch[1]);
					if(ch[1].trim() === "0"){
						$("div#experimentLoad").addClass("d-none");
						$("div#experimentStart").removeClass("d-none");
					}
					if(ch[1].trim() === "1"){
						$("div#experimentStart").addClass("d-none");
						$("div#experimentReady").removeClass("d-none");
					}
				}
				if(data.line.match("^Empezando")){
					ch = data.line.split(":");
					dbS = ch[1].split("b");
					dbLoad = "#db"+dbS[1].trim()+"Load"
					dbStart = "#db"+dbS[1].trim()+"Start";
					$(dbLoad).addClass("d-none");
					$(dbStart).removeClass("d-none");
					countDB++;
				}
				if(data.line.match("^Terminaron")){
					ch = data.line.split(":");
					dbF = ch[1].split("b");
					dbStartF = "#db"+dbF[1].trim()+"Start"
					dbReady = "#db"+dbF[1].trim()+"Ready";
					$(dbStartF).addClass("d-none");
					$(dbReady).removeClass("d-none");
					if(data.dbCount == countDB){
						console.log("Entra");
						$("#resultsBt").removeClass("disabled");
					}
				}
			}
		});
	}
	$(document).ready(function(){
		//TODO: Acceso a countDB
		countDB = 0;
		setInterval(readFile, 10000);
	});
</script>
{% endblock extrafooter %}